<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.springboot.mapper.OrderMapper">
    <!-- 分页查询，可通过工单编号和时间范围筛选 -->
    <select id="getOrdersByPage" parameterType="com.example.springboot.utils.Condition" resultType="com.example.springboot.entity.OrderInfo">
        select order_info.*,maintance_info.plan_name
        from order_info,maintance_info
        <where>
            /* 必须条件设置为永真 */
            <if test="true">
                order_info.plan_id = maintance_info.plan_id
            </if>
            <if test="orderId != null and orderId != ''">
                and order_id like CONCAT('%',#{orderId},'%')
            </if>
            <if test="startTime != null and endTime != null">
                /* 两张表中都存在开始与结束时间的字段，不指定报错ambiguous，即字段不确定，往前端查错没用 */
                and order_info.start_time &gt; #{startTime} and order_info.end_time &lt; #{endTime}
            </if>
        </where>
        limit #{limit} offset #{offset}
    </select>
    <!-- 条件查询（筛选）后的总数据条数 -->
    <select id="getOrdersCountByCondition">
        select count(*)
        from order_info,maintance_info
        <where>
            <if test="true">
                order_info.plan_id = maintance_info.plan_id
            </if>
            <if test="orderId != null and orderId != ''">
                and order_id like CONCAT('%',#{orderId},'%')
            </if>
        </where>
    </select>
</mapper>
